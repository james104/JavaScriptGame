<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="gameStatus.js"></script>

</head>
<body>
<!--<img id="player" class="character" src="img/woody_s.bmp" style="left:0px;top:0px;position:absolute;">-->
<div id="gameStatus">
    <div id="gameTime">00:00</div>
</div>

<img src="img/bc2.bmp" width="1500" height="300" style="position:absolute;" />

<canvas id="gameCanvas" width="1500" height="400" style="margin:300px 0 0 0;background:url(img/floor3.bmp);background-repeat:no-repeat;background-size:cover;">

</canvas>

<script type="text/javascript">
    //canvas
    var canvasElement = document.getElementById("gameCanvas");
    var ctx = canvasElement.getContext && canvasElement.getContext('2d');
        
    function drawInCanvas(canvas,drawType,oriImage,reqImageX,reqImageY,reqImageW,reqImageH,canvasX,canvasY){
        if(drawType == "player"){
            canvas.drawImage(oriImage,reqImageX,reqImageY,reqImageW,reqImageH,canvasX,canvasY,reqImageW,reqImageH);
            removeBackground(canvasX,canvasY,reqImageW,reqImageH);
        }
    }

    function removeBackground(canvasX,canvasY,reqImageW,reqImageH){
        //remove image background 
        var imgd = ctx.getImageData(canvasX, canvasY, reqImageW, reqImageH),pix = imgd.data,newColor = {r:0,g:0,b:0, a:0};
        for (var i = 0, n = pix.length; i <n; i += 4) {
            var r = pix[i],g = pix[i+1],b = pix[i+2];
        
            if(r == 0 && g == 0 && b == 0){
                // Change the white to the new color.
                pix[i] = newColor.r;
                pix[i+1] = newColor.g;
                pix[i+2] = newColor.b;
                pix[i+3] = newColor.a;
            }
        }
        ctx.putImageData(imgd, canvasX, canvasY);
    }

    
    //player
    playerImage = new Image();
    playerImage.id = "playerImage";
    playerImage.src = "img/woody_0.bmp";
    playerImage.onload = drawInCanvas(ctx,"player",playerImage,18,5,41,75,100,100);

    var keyStatus = [];    
    var playerObject = new playerObject();

    function playerObject(){
        this.speed = 5;
        this.x = 100;
        this.y = 100;
    }

    setInterval(checkActionMove, 20);
    
    document.onkeydown = function(key){
        keyStatus[key.keyCode] = true;
    };

    document.onkeyup = function(key){
        delete keyStatus[key.keyCode];
    };

    function checkActionMove(){
        if (keyStatus[37]){//left
            //console.log("37"+ keyStatus[37]);
            //player.style.left = (parseInt(player.style.left) - 5) + "px";
            ctx.clearRect(playerObject.x,playerObject.y,playerImage.width,playerImage.height);
            playerObject.x -= playerObject.speed;
            drawInCanvas(ctx,"player",playerImage,18,5,41,75,playerObject.x,playerObject.y);
        }
        if (keyStatus[38]){//up
            //console.log("38"+ keyStatus[38]);
            //player.style.top = (parseInt(player.style.top) - 5) + "px";
            ctx.clearRect(playerObject.x,playerObject.y,playerImage.width,playerImage.height);
            playerObject.y -= playerObject.speed;
            drawInCanvas(ctx,"player",playerImage,18,5,41,75,playerObject.x,playerObject.y);
        }
        if (keyStatus[39]){//right
            //console.log("39"+ keyStatus[39]);
            //player.style.left = (parseInt(player.style.left) + 5) + "px";
            ctx.clearRect(playerObject.x,playerObject.y,playerImage.width,playerImage.height);
            playerObject.x += playerObject.speed;
            drawInCanvas(ctx,"player",playerImage,18,5,41,75,playerObject.x,playerObject.y);
        }
        if (keyStatus[40]){//down
            //console.log("40"+ keyStatus[40]);
            //player.style.top = (parseInt(player.style.top) + 5) + "px";
            ctx.clearRect(playerObject.x,playerObject.y,playerImage.width,playerImage.height);
            playerObject.y += playerObject.speed;
            drawInCanvas(ctx,"player",playerImage,18,5,41,75,playerObject.x,playerObject.y);
        }
        
    }
</script>

</body>
</html>